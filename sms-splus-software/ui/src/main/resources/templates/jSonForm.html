<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="vi">
	<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <title>Tạo ticket</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
<h1>Tạo ticket</h1>
	<div class="elements" th:each="element  : ${ELEMENTS}" th:switch="${element.dataType}">	
			<div class="individual" th:case="'individual'">
				<h1 th:text="${element.name}"></h1>
		        <span th:text="${element.name}">001</span>
		        <input th:id="${element.id}" class="value" th:value="${element.data.value}" value=""/>
		    </div>
		    <div class="table" th:case="'table'">
		    	<h1 th:text="${element.name}"></h1>
		        <table border="1">
		        	<tr>
		        		<th th:each="column : ${element.data.columns}" th:text="${column.name}"></th>
		        	</tr>
		     		<tr th:each="i : ${#numbers.sequence(1,__${element.data.maxRow}__)}">
		     			<td th:each="column : ${element.data.columns}">
		     				<input class="value" th:attr="column=${value.columnId},row=${value.row},id=${element.id}" th:placeholder="${column.conditions.format} ? ${column.conditions.format.text} : '' " th:each="value,vCounter: ${element.data.values}" th:if="${value.columnId == column.id} and ${value.row == i} and ${column.type != 'select'}" th:value="${value.value}"></input>
		     				<select class="value" th:attr="column=${value.columnId},row=${value.row},id=${element.id}" th:each="value: ${element.data.values}" th:if="${value.columnId == column.id} and ${value.row == i} and ${column.type == 'select'}">
		     					<option value="" th:if="${not column.conditions.required}">--Empty Selection--</option>
		     					<option th:selected="${data.value == value.value}" th:each="data : ${column.conditions.data}" th:text="${data.text}" th:value="${data.value}"></option>
		     				</select>
		     			</td>
		     		</tr>
		        </table>
		    </div>
		    <div class="matrix" th:case="'matrix'">
		    	<h1 th:text="${element.name}"></h1>
		        <table border="1">
		        	<tr>
		        		<td>X</td>
		        		<td th:each="column : ${element.data.columns}" th:text="${column.name}"></td>
		        	</tr>
		     		<tr th:each="row : ${element.data.rows}">
		     			<td th:text="${row.name}"></td>
		     			<td th:each="column : ${element.data.columns}">
		     				<input class="value"  th:attr="column=${value.columnId},row=${value.rowId},id=${element.id}" th:placeholder="${value.conditions?.format?.text}" th:each="value,vCounter: ${element.data.values}" th:if="${value.columnId == column.id} and ${value.rowId == row.id} and ${value.type != 'select'}" th:value="${value.value}"></input>
		     				<select class="value" th:attr="column=${value.columnId},row=${value.rowId},id=${element.id}" th:each="value: ${element.data.values}" th:if="${value.columnId == column.id} and ${value.rowId == i} and ${value.type == 'select'}">
		     					<option value="" th:if="${not value.conditions.required}">--Empty Selection--</option>
		     					<option th:each="data : ${value.conditions.data}" th:text="${data.text}" th:value="${data.value}"></option>
		     				</select>
		     			</td>
		     		</tr>
		        </table>
		    </div>
     </div>
<button class="btnSubmit">Submit</button>
<script>

$(document).ready(function(){
		function saveIndividual(target){
			$.ajax({
				  method: "POST",
				  url: "draft",
				  data: {value : $(target).val(), id : $(target).attr("id")}
				})
				  .done(function( msg ) {
				    console.log( "Result: " + msg );
				  });
		}
		
		function saveTable(target){
			$.ajax({
				  method: "POST",
				  url: "draftTable",
				  data: {value : $(target).val(), id : $(target).attr("id"), x : $(target).attr("column"), y : $(target).attr("row")}
				})
				  .done(function( msg ) {
					  console.log( "Result: " + msg );
				  });
		}
		function saveTable(target){
			$.ajax({
				  method: "POST",
				  url: "draftMatrix",
				  data: {value : $(target).val(), id : $(target).attr("id"), x : $(target).attr("column"), y : $(target).attr("row")}
				})
				  .done(function( msg ) {
					  console.log( "Result: " + msg );
				  });
		}
		$(".btnSubmit").click(function(){
			$.ajax({
				  method: "GET",
				  url: "submit",
				  data: {}
				})
				  .done(function( msg ) {
				  });
		});
		$(".individual .value").change(function(){
			saveIndividual(this);
		});
		$(".table .value").change(function(){
			saveTable(this);
		});
		$(".matrix .value").change(function(){
			saveTable(this);
		});
});
</script>
</body>
</html>